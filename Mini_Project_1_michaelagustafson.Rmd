---
title: "Mini Project 1"
author: "Michaela Gustafson"
date: "10/16/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Spatial Data in R: Mini Project 1

The goals for this phase of your final project are:

Articulate an interesting research question based on a dataset you’d like to learn more about.

Develop a spatial database that contains potentially relevant explanatory variables that you’d like to explore in the context of that research question.

Demonstrate an understanding of the various workflow elements involved in designing and constructing a spatial database for subsequent visualization and analysis.

```{r library}
library(here)
library(tidyr)
library(dplyr)
library(terra)
library(sf)
library(tidyverse)

```

# A. Regions

## 1. New Zealand Region Data
 Data source: https://catalogue.data.govt.nz/dataset

The regions of New Zealand are my 'regions' I will use to organize higher order variables.

```{r gitnzcencsu}
# Find "Regional Council 2018 Clipped (generalised)"
# select the GeoPackage option in the "Vectors/tables" dropdown
# at https://datafinder.stats.govt.nz/data/ (requires registration)
# Save the result as:

unzip("statsnzregional-council-2018-clipped-generalised-SHP.zip")
nz.full.shp <- st_read("regional-council-2018-clipped-generalised.shp")

plot(st_geometry(nz.full.shp))
# print(object.size(nz_full), units = "Kb") # 14407.2 Kb

# nz <- st_simplify(nz_full, dTolerance = 1000)


names(nz.full.shp)
nz.full.shp$REGC2018_1
nz = filter(nz.full.shp, REGC2018_1 != "Area Outside Region") %>%
        select(Region = REGC2018_1)

st_is_valid(nz)
st_crs(nz)

nz.reg.coun <- read.csv("regional_council_2018_csv.csv")
nz.reg.coun <- filter(nz.reg.coun, REGC2018_V1_00_NAME != "Area Outside Region") %>%
  select(Region = REGC2018_V1_00_NAME, Area_SQKM = LAND_AREA_SQ_KM)

# join nz.reg.coun with spatial data nz

nz.shp <- inner_join(nz, nz.reg.coun, by = "Region")


```
# B. Tabular Data
## 1. Census Data

Data source: https://www.stats.govt.nz/topics/census

I will use census data to determine the population density/sqkm in areas of the regions (urban vs rural) and overall population density/sqkm of a region. This information will be best used to determine good regions for individuals to go to be in less populated areas and have a better chance of avoiding other people and potential zombie infection.

```{r nzcensus}
nz.census <- read.csv("Census_Usually_resident_population_count_and_change_by_region_2006_2013_and_2018.csv")

names(nz.census)
nz.census <- filter(nz.census, X...Census.year == "2018") %>%
  select(Year = X...Census.year, Region, Population = Value)


census2 <- read.csv("2018-Census-urban-accessibility-dataset-csv.csv")

census2 <- census2 %>% 
  dplyr::select(RC_IUA2018_V1_00_NAME, starts_with("C18"))



```

# Urban vs Rural shapefile

```{r urbrur}
unzip("statsnzurban-rural-2021-generalised-SHP.zip")
urbrur <- read_sf("urban-rural-2021-generalised.shp")
plot(st_geometry(urbrur))

unique(urbrur$IUR2021__1)

head(urbrur)

urban <- urbrur %>%
  select(Name = UR2021_V_2, Urban = IUR2021__1, AreaSQKM = AREA_SQ_KM, geometry)

head(urban)


```


# Upload zombie data

```{r zombieload}

zom <- read.csv("zombies.csv")

head(zom); dim(zom)

zombie.shp <- read_sf(here("New_Zealand_Zombie_Attack_Data.shp"))
plot(zombie.shp)

```


# Spatial Join

# Join urban/rural information with regions using st_is_within

```{r}

st_crs(urban) == st_crs(nz.shp)

region.urban.join <- st_join(urban, nz.shp, join=st_intersects)
unique(region.urban.join$Name)

duplicated(region.urban.join$Name)

# okay so what I can't understand here is that there are duplicated rows but I can't actually find any of the names in the dataframe duplicated... This is likely because with using intersect, just because the boundaries don't match up exactly, some shapefiles might cross with another boundary..
```

## Join Zombie Attack locations with joined frame above:

```{r}
st_crs(zombie.shp) == st_crs(region.urban.join)

st_crs(zombie.shp)
st_crs(region.urban.join)

?st_transform
zombie.shp.proj <- st_transform(zombie.shp, crs = st_crs(region.urban.join))
st_crs(zombie.shp.proj) == st_crs(region.urban.join)


region.zombie.join <- st_join(zombie.shp.proj, nz.shp, join = st_within)
```


# Summarize

## Summarize the number of attacks per region

```{r}
attacks.per.region <- region.zombie.join %>% 
  group_by(Region) %>% 
  summarize(., Total_Attacks = sum(Attacks))

?summarize
```

