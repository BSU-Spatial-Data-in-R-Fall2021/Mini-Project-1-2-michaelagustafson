---
title: "Mini Project 1"
author: "Michaela Gustafson"
date: "10/16/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Spatial Data in R: Mini Project 1

The goals for this phase of your final project are:

Articulate an interesting research question based on a dataset you’d like to learn more about.

Develop a spatial database that contains potentially relevant explanatory variables that you’d like to explore in the context of that research question.

Demonstrate an understanding of the various workflow elements involved in designing and constructing a spatial database for subsequent visualization and analysis.

```{r library}
library(here)
library(tidyr)
library(dplyr)
library(terra)
library(sf)
library(tidyverse)

```

# A. Regions

## 1. New Zealand Region Data
 Data source: https://datafinder.stats.govt.nz/layer/98765-regional-council-2019-clipped-generalised/

The regions of New Zealand are my 'regions' I will use to organize higher order variables.

```{r gitnzcencsu}
# Find "Regional Council 2018 Clipped (generalised)"
# select the GeoPackage option in the "Vectors/tables" dropdown
# at https://datafinder.stats.govt.nz/data/ (requires registration)
# Save the result as:

unzip("statsnzregional-council-2019-clipped-generalised-SHP.zip")
nz.full.shp <- st_read("regional-council-2019-clipped-generalised.shp")

plot(st_geometry(nz.full.shp))
# print(object.size(nz_full), units = "Kb") # 14407.2 Kb

# nz <- st_simplify(nz_full, dTolerance = 1000)


names(nz.full.shp)
nz.full.shp$REGC2019_1
nz.reg.shp = filter(nz.full.shp, REGC2019_1 != "Area Outside Region") %>%
        select(Region = REGC2019_1, AreaSQKM = AREA_SQ_KM, geometry)

st_is_valid(nz.reg.shp)
st_crs(nz.reg.shp)

```
# B. Tabular Data
## 1. Census Data

Data source: https://www.stats.govt.nz/topics/census

I will use census data to determine the population density/sqkm in areas of the regions (urban vs rural) and overall population density/sqkm of a region. This information will be best used to determine good regions for individuals to go to be in less populated areas and have a better chance of avoiding other people and potential zombie infection.

```{r nzcensus}
nz.census <- read.csv("Census_Usually_resident_population_count_and_change_by_region_2006_2013_and_2018.csv")

names(nz.census)
nz.census <- filter(nz.census, X...Census.year == "2018") %>%
  select(Year = X...Census.year, Region, Population = Value)


census2 <- read.csv("2018-Census-urban-accessibility-dataset-csv.csv")

census2 <- census2 %>% 
  dplyr::select(RC_IUA2018_V1_00_NAME, starts_with("C18"))



```

# Urban vs Rural shapefile

https://datafinder.stats.govt.nz/layer/98743-urban-rural-2019-clipped-generalised/

```{r urbrur}
unzip("statsnzurban-rural-2019-clipped-generalised-SHP.zip")
urbrur <- read_sf("urban-rural-2019-clipped-generalised.shp")
plot(st_geometry(urbrur))

urban <- urbrur %>%
  select(Name = UR2019_V_1, Urban = IUR2019__1, AreaSQKM = AREA_SQ_KM, geometry)


```


# Upload zombie data

```{r zombieload}

zom <- read.csv("zombies.csv")

head(zom); dim(zom)

zombie.shp <- read_sf(here("New_Zealand_Zombie_Attack_Data.shp"))
plot(zombie.shp)

```


# Spatial Join

# Join urban/rural information with regions using st_is_within

```{r}

st_crs(urban) == st_crs(nz.shp)

region.urban.join <- st_join(urban, nz.shp, join=st_within)

# yayayya ended up with same number of observations as in the 'urban' dataset

```

## Join Zombie Attack locations with joined frame above:

```{r}
st_crs(zombie.shp) == st_crs(region.urban.join)

st_crs(zombie.shp)
st_crs(region.urban.join)

?st_transform
zombie.shp.proj <- st_transform(zombie.shp, crs = st_crs(region.urban.join))
st_crs(zombie.shp.proj) == st_crs(region.urban.join)

reg.urb.zom.join <- st_join(zombie.shp.proj, region.urban.join, join = st_within)
region.zombie.join <- st_join(zombie.shp.proj, nz.shp, join = st_within)
```


# Summarize

## Summarize the number of attacks per region

```{r}
attacks.per.region <- region.zombie.join %>% 
  group_by(Region) %>% 
  summarize(., Total_Attacks = sum(Attacks))

print(attacks.per.region)


# get population density for each region? And then attacks/pop/sqkm?
```

```{r}
# collapse 'urban' to just urban and rural then find the number of attacks that occur in urban vs rural areas
```

























